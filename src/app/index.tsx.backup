import React, { useState, useEffect } from 'react';
import { SafeAreaView } from 'react-native-safe-area-context';
import NotesList from '../components/NotesList';
import NoteEditor from '../components/NoteEditor';
import { Note } from '../storage/notesStorage';

export default function Index() {
  const [currentView, setCurrentView] = useState<'list' | 'editor'>('list');
  const [currentNote, setCurrentNote] = useState<Note | null>(null);
  const [refreshKey, setRefreshKey] = useState(0);

  const handleNewNote = () => {
    setCurrentNote(null);
    setCurrentView('editor');
  };

  const handleNotePress = (note: Note) => {
    setCurrentNote(note);
    setCurrentView('editor');
  };

  const handleSaveNote = (note: Note) => {
    setCurrentView('list');
    // ForÃ§a o recarregamento da lista
    setRefreshKey(prev => prev + 1);
  };

  const handleCancelEdit = () => {
    setCurrentView('list');
    setCurrentNote(null);
  };

  if (currentView === 'editor') {
    return (
      <NoteEditor
        note={currentNote}
        onSave={handleSaveNote}
        onCancel={handleCancelEdit}
      />
    );
  }

  return (
    <SafeAreaView style={{ flex: 1 }}>
      <NotesList
        key={refreshKey}
        onNotePress={handleNotePress}
        onNewNote={handleNewNote}
      />
    </SafeAreaView>
  );
}

